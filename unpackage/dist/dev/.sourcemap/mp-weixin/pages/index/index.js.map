{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../../360极速浏览器下载/HBuilderX.4.29.2024093009/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 顶部信息栏 -->\r\n    <view class=\"header\">\r\n      <view class=\"date-time\">\r\n        <text class=\"date\">{{ formatDate }}</text>\r\n        <text class=\"time\">{{ formatTime }}</text>\r\n      </view>\r\n      <view class=\"weather\">\r\n        <image src=\"/static/home/定位.svg\" class=\"location-icon\"></image>\r\n        <text>{{ city }}</text>\r\n        <text>{{ temperature }}°C {{ weatherText }}</text>\r\n      </view>\r\n    </view>\r\n    <!-- 中间状态显示 -->\r\n    <view class=\"status-container\">\r\n      <text class=\"status-text\">下班倒计时</text>\r\n      <text class=\"status-result\">工作已结束!</text>\r\n    </view>\r\n    <!-- 待办事项 -->\r\n    <TodoList />\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from \"vue\";\r\nimport { getQWeather, getLocationId } from \"@/api/search.js\";\r\nimport TodoList from \"@/components/home/TodoList.vue\";\r\n\r\nconst currentDate = ref(new Date());\r\nconst temperature = ref(\"--\");\r\nconst weatherText = ref(\"未知\");\r\nconst city = ref(\"定位中...\");\r\n\r\n// 格式化日期\r\nconst formatDate = computed(() => {\r\n  const date = currentDate.value;\r\n  return `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;\r\n});\r\n\r\n// 格式化时间\r\nconst formatTime = computed(() => {\r\n  const date = currentDate.value;\r\n  const hours = String(date.getHours()).padStart(2, \"0\");\r\n  const minutes = String(date.getMinutes()).padStart(2, \"0\");\r\n  const seconds = String(date.getSeconds()).padStart(2, \"0\");\r\n  return `${hours}:${minutes}:${seconds}`;\r\n});\r\n\r\n// 更新时间\r\nconst updateDateTime = () => {\r\n  currentDate.value = new Date();\r\n};\r\n\r\n// 获取天气数据\r\nconst getWeatherData = async (locationId) => {\r\n  try {\r\n    const res = await getQWeather(locationId);\r\n    if (res && res.now) {\r\n      temperature.value = res.now.temp;\r\n      weatherText.value = res.now.text;\r\n    }\r\n  } catch (error) {\r\n    console.error(\"获取天气数据失败:\", error);\r\n    uni.showToast({\r\n      title: \"获取天气信息失败\",\r\n      icon: \"none\",\r\n      duration: 2000,\r\n    });\r\n  }\r\n};\r\n\r\n// 获取位置信息\r\nconst getLocation = () => {\r\n  // 先检查缓存\r\n  const cachedLocation = uni.getStorageSync(\"locationCache\");\r\n  const cacheTime = uni.getStorageSync(\"locationCache_time\");\r\n  const CACHE_DURATION = 5 * 60 * 1000; // 5分钟缓存\r\n\r\n  if (cachedLocation && cacheTime && Date.now() - cacheTime < CACHE_DURATION) {\r\n    city.value = cachedLocation.name;\r\n    return getWeatherData(cachedLocation.id);\r\n  }\r\n\r\n  return new Promise((resolve, reject) => {\r\n    // 先请求授权\r\n    uni.authorize({\r\n      scope: \"scope.userLocation\",\r\n      success: () => {\r\n        // 授权成功后获取位置\r\n        uni.getLocation({\r\n          type: \"wgs84\",\r\n          success: async (res) => {\r\n            try {\r\n              const cityData = await getLocationId(res.longitude, res.latitude);\r\n              city.value = cityData.name;\r\n              await getWeatherData(cityData.id);\r\n              resolve(cityData);\r\n            } catch (error) {\r\n              console.error(\"位置信息处理失败:\", error);\r\n              city.value = \"未知位置\";\r\n              await getWeatherData();\r\n              reject(error);\r\n            }\r\n          },\r\n          fail: (err) => {\r\n            console.error(\"获取位置失败:\", err);\r\n            city.value = \"未知位置\";\r\n            getWeatherData();\r\n            reject(err);\r\n          },\r\n        });\r\n      },\r\n      fail: (err) => {\r\n        console.error(\"位置授权失败:\", err);\r\n        // 如果是拒绝授权，显示打开设置的对话框\r\n        uni.showModal({\r\n          title: \"提示\",\r\n          content:\r\n            \"需要获取您的位置才能显示准确的天气信息，是否打开设置页面重新授权？\",\r\n          success: (res) => {\r\n            if (res.confirm) {\r\n              uni.openSetting();\r\n            }\r\n          },\r\n        });\r\n        city.value = \"未知位置\";\r\n        getWeatherData();\r\n        reject(err);\r\n      },\r\n    });\r\n  });\r\n};\r\n\r\n// 初始化函数\r\nconst init = async () => {\r\n  try {\r\n    await getLocation();\r\n  } catch (error) {\r\n    console.error(\"初始化位置或天气失败:\", error);\r\n  }\r\n};\r\n\r\n// 在组件挂载时初始化\r\nonMounted(() => {\r\n  // 初始化时间\r\n  updateDateTime();\r\n  // 设置定时器，每秒更新一次\r\n  setInterval(updateDateTime, 1000);\r\n  // 获取位置和天气\r\n  init();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container {\r\n  padding: 20px;\r\n  background-color: $theme-color;\r\n  min-height: 100vh;\r\n  height: 100vh;\r\n  color: $text-color;\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  padding: 20px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.date-time {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 5px;\r\n}\r\n\r\n.date,\r\n.time {\r\n  font-size: 16px;\r\n  color: $brand-color;\r\n}\r\n\r\n.weather {\r\n  font-size: 16px;\r\n  display: flex;\r\n  align-items: center;\r\n  color: $brand-color;\r\n  gap: 4rpx;\r\n\r\n  .location-icon {\r\n    width: 36rpx;\r\n    height: 36rpx;\r\n    display: inline-block;\r\n    fill: $brand-color;\r\n    transition: fill 0.3s ease;\r\n\r\n    &:hover {\r\n      fill: darken($brand-color, 10%);\r\n    }\r\n  }\r\n\r\n  text {\r\n    line-height: 36rpx;\r\n  }\r\n}\r\n\r\n.status-container {\r\n  text-align: center;\r\n}\r\n\r\n.status-text {\r\n  font-size: 18px;\r\n  margin-bottom: 10px;\r\n  display: block;\r\n  color: $text-color-secondary;\r\n}\r\n\r\n.status-result {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  display: block;\r\n  color: $brand-color;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/por/cursor/xcx/freeyunpan/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","getQWeather","uni","getLocationId","onMounted","MiniProgramPage"],"mappings":"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"}