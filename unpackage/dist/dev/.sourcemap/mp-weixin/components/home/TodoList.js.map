{"version":3,"file":"TodoList.js","sources":["components/home/TodoList.vue","../../../../360极速浏览器下载/HBuilderX.4.29.2024093009/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovcG9yL2N1cnNvci94Y3gvZnJlZXl1bnBhbi9jb21wb25lbnRzL2hvbWUvVG9kb0xpc3QudnVl"],"sourcesContent":["<template>\r\n  <view class=\"todo-list\">\r\n    <view class=\"section-title\">\r\n      <text>待办事项</text>\r\n      <text class=\"add-btn\" @tap=\"addTodo\">+</text>\r\n    </view>\r\n\r\n    <view v-if=\"loading\" class=\"loading-state\">\r\n      <text>正在分析待办事项...</text>\r\n    </view>\r\n\r\n    <view v-else class=\"todo-items\">\r\n      <view v-if=\"todos.length === 0\" class=\"empty-state\">\r\n        <text>暂无待办事项</text>\r\n      </view>\r\n      <view\r\n        v-else\r\n        v-for=\"(todo, index) in todos\"\r\n        :key=\"index\"\r\n        class=\"todo-item\"\r\n      >\r\n        <checkbox\r\n          :checked=\"todo.completed\"\r\n          @tap=\"toggleTodo(index)\"\r\n          :disabled=\"todo.completed\"\r\n        ></checkbox>\r\n        <text :class=\"{ 'todo-text': true, completed: todo.completed }\">\r\n          {{ todo.text }}\r\n        </text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nimport { onShow, onHide } from \"@dcloudio/uni-app\";\r\nimport { analyzeTodoList } from \"@/api/search.js\";\r\n\r\nconst todos = ref([]);\r\nconst loading = ref(false);\r\n\r\n// 添加路由监听，当从备忘录页面返回时触发分析\r\nlet isVisible = ref(false);\r\n\r\nconst loadTodos = async () => {\r\n  const notes = uni.getStorageSync(\"notes\") || [];\r\n  const completedTodos = uni.getStorageSync(\"completedTodos\") || [];\r\n  const analyzedTodosCache = uni.getStorageSync(\"analyzedTodos\") || {};\r\n\r\n  loading.value = true;\r\n  try {\r\n    const analyzedNotes = await Promise.all(\r\n      notes.map(async (note) => {\r\n        const originalContent = note.content;\r\n        const isCompleted =\r\n          completedTodos.includes(originalContent) || note.completed;\r\n\r\n        if (isCompleted) {\r\n          return {\r\n            text: analyzedTodosCache[originalContent] || originalContent,\r\n            completed: true,\r\n            originalContent,\r\n          };\r\n        }\r\n\r\n        if (analyzedTodosCache[originalContent]) {\r\n          return {\r\n            text: analyzedTodosCache[originalContent],\r\n            completed: false,\r\n            originalContent,\r\n          };\r\n        }\r\n\r\n        try {\r\n          const analysis = await analyzeTodoList(originalContent);\r\n          const parsedAnalysis =\r\n            typeof analysis === \"string\" ? JSON.parse(analysis) : analysis;\r\n          const outputText = parsedAnalysis.output || originalContent;\r\n\r\n          analyzedTodosCache[originalContent] = outputText;\r\n          uni.setStorageSync(\"analyzedTodos\", analyzedTodosCache);\r\n\r\n          return {\r\n            text: outputText,\r\n            completed: false,\r\n            originalContent,\r\n          };\r\n        } catch (error) {\r\n          console.error(\"待办事项分析失败:\", error);\r\n          return {\r\n            text: originalContent,\r\n            completed: false,\r\n            originalContent,\r\n          };\r\n        }\r\n      })\r\n    );\r\n    todos.value = analyzedNotes;\r\n  } catch (error) {\r\n    console.error(\"加载待办事项失败:\", error);\r\n    todos.value = notes.map((note) => ({\r\n      text: note.content,\r\n      completed: false,\r\n      originalContent: note.content,\r\n    }));\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\nonShow(() => {\r\n  if (!isVisible.value) {\r\n    isVisible.value = true;\r\n    loadTodos();\r\n  }\r\n});\r\n\r\nonHide(() => {\r\n  isVisible.value = false;\r\n});\r\n\r\nconst addTodo = () => {\r\n  uni.navigateTo({\r\n    url: \"/pages/note/index\",\r\n  });\r\n};\r\n\r\nconst toggleTodo = (index) => {\r\n  if (!todos.value[index].completed) {\r\n    todos.value[index].completed = true;\r\n\r\n    const originalContent = todos.value[index].originalContent;\r\n\r\n    const completedTodos = uni.getStorageSync(\"completedTodos\") || [];\r\n    console.log(completedTodos, \"completedTodos\");\r\n    if (!completedTodos.includes(originalContent)) {\r\n      completedTodos.push(originalContent);\r\n      uni.setStorageSync(\"completedTodos\", completedTodos);\r\n    }\r\n\r\n    const notes = uni.getStorageSync(\"notes\") || [];\r\n    const noteIndex = notes.findIndex(\r\n      (note) => note.content === originalContent\r\n    );\r\n    if (noteIndex !== -1) {\r\n      notes[noteIndex].completed = true;\r\n      uni.setStorageSync(\"notes\", notes);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.todo-list {\r\n  padding: 20rpx;\r\n  background-color: $uni-color-white;\r\n  border-radius: $uni-radius-lg;\r\n  margin-top: 40rpx;\r\n  .section-title {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    font-size: $uni-font-size-lg;\r\n    color: $text-color;\r\n    margin-bottom: 20rpx;\r\n    font-weight: 500;\r\n\r\n    .add-btn {\r\n      font-size: 40rpx;\r\n      color: $brand-color;\r\n      padding: 0 20rpx;\r\n    }\r\n  }\r\n\r\n  .todo-items {\r\n    .todo-item {\r\n      display: flex;\r\n      align-items: center;\r\n      padding: 20rpx 0;\r\n      border-bottom: 1px solid $uni-color-border;\r\n\r\n      &:last-child {\r\n        border-bottom: none;\r\n      }\r\n    }\r\n\r\n    .todo-text {\r\n      margin-left: 20rpx;\r\n      color: $text-color;\r\n      white-space: pre-wrap;\r\n\r\n      &.completed {\r\n        text-decoration: line-through;\r\n        color: $text-color-secondary;\r\n      }\r\n    }\r\n  }\r\n\r\n  .empty-state {\r\n    text-align: center;\r\n    padding: 40rpx;\r\n    color: $text-color-secondary;\r\n    font-size: $uni-font-size-base;\r\n  }\r\n\r\n  .loading-state {\r\n    text-align: center;\r\n    padding: 40rpx;\r\n    color: $text-color-secondary;\r\n    font-size: $uni-font-size-base;\r\n  }\r\n\r\n  .todo-item {\r\n    checkbox {\r\n      &[disabled] {\r\n        opacity: 0.5;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import Component from 'D:/por/cursor/xcx/freeyunpan/components/home/TodoList.vue'\nwx.createComponent(Component)"],"names":["ref","uni","analyzeTodoList","onShow","onHide"],"mappings":"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"}